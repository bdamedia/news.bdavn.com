!function(l){l.fn.yiiActiveForm=function(t){return g[t]?g[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(l.error("Method "+t+" does not exist on jQuery.yiiActiveForm"),!1):g.init.apply(this,arguments)};var n,e="beforeValidate",u="afterValidate",d="beforeValidateAttribute",c="afterValidateAttribute",r="beforeSubmit",v="ajaxBeforeSend",h="ajaxComplete",s="afterInit",o={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0,scrollToErrorOffset:0,validationStateOn:"container"},f={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0,updateAriaInvalid:!0},m=function(t){n&&(n.resolve(),n=void 0,t.removeData("yiiSubmitFinalizePromise"))},g={init:function(a,n){return this.each(function(){var i=l(this);if(!i.data("yiiActiveForm")){var t=l.extend({},o,n||{});void 0===t.validationUrl&&(t.validationUrl=i.attr("action")),l.each(a,function(t){a[t]=l.extend({value:x(i,this)},f,this),y(i,a[t])}),i.data("yiiActiveForm",{settings:t,attributes:a,submitting:!1,validated:!1,options:C(i)}),i.on("reset.yiiActiveForm",g.resetForm),t.validateOnSubmit&&(i.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){i.data("yiiActiveForm").submitObject=l(this)}),i.on("submit.yiiActiveForm",g.submitForm));var e=l.Event(s);i.trigger(e)}})},add:function(t){var i=l(this);t=l.extend({value:x(i,t)},f,t),i.data("yiiActiveForm").attributes.push(t),y(i,t)},remove:function(i){var t=l(this),e=t.data("yiiActiveForm").attributes,a=-1,n=void 0;return l.each(e,function(t){if(e[t].id==i)return n=e[a=t],!1}),0<=a&&(e.splice(a,1),b(t,n)),n},validateAttribute:function(t){var i=g.find.call(this,t);null!=i&&a(l(this),i,!0)},find:function(i){var e=l(this).data("yiiActiveForm").attributes,a=void 0;return l.each(e,function(t){if(e[t].id==i)return a=e[t],!1}),a},destroy:function(){return this.each(function(){l(this).off(".yiiActiveForm"),l(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(t){t&&(l(this).data("yiiActiveForm").submitting=!0);var a=l(this),n=a.data("yiiActiveForm"),r=!1,s={},o=p(),u=n.submitting;if(u){var i=l.Event(e);if(a.trigger(i,[s,o]),!1===i.result)return n.submitting=!1,void m(a)}l.each(n.attributes,function(){this.$form=a;var t=T(a,this);if(t.is(":disabled"))return!0;if(t.length&&"select"===t[0].tagName.toLowerCase()){if(!t[0].options.length)return!0;if(1===t[0].options.length&&""===t[0].options[0].value)return!0}if(this.cancelled=!1,n.submitting||2===this.status||3===this.status){var i=s[this.id];void 0===i&&(i=[],s[this.id]=i);var e=l.Event(d);a.trigger(e,[this,i,o]),!1!==e.result?(this.validate&&this.validate(this,x(a,this),i,o,a),this.enableAjaxValidation&&(r=!0)):this.cancelled=!0}}),l.when.apply(this,o).always(function(){for(var t in s)0===s[t].length&&delete s[t];if(r&&(l.isEmptyObject(s)||n.submitting)){var i=n.submitObject,e="&"+n.settings.ajaxParam+"="+a.attr("id");i&&i.length&&i.attr("name")&&(e+="&"+i.attr("name")+"="+i.attr("value")),l.ajax({url:n.settings.validationUrl,type:a.attr("method"),data:a.serialize()+e,dataType:n.settings.ajaxDataType,complete:function(t,i){a.trigger(h,[t,i])},beforeSend:function(t,i){a.trigger(v,[t,i])},success:function(t){null!==t&&"object"==typeof t?(l.each(n.attributes,function(){this.enableAjaxValidation&&!this.cancelled||delete t[this.id]}),F(a,l.extend(s,t),u)):F(a,s,u)},error:function(){n.submitting=!1,m(a)}})}else n.submitting?window.setTimeout(function(){F(a,s,u)},200):F(a,s,u)})},submitForm:function(){var t,i=l(this),e=i.data("yiiActiveForm");if(e.validated){e.submitting=!1;var a=l.Event(r);return i.trigger(a),!1===a.result?(e.validated=!1,m(i),!1):(j(i),!0)}return t=i,n=l.Deferred(),t.data("yiiSubmitFinalizePromise",n.promise()),void 0!==e.settings.timer&&clearTimeout(e.settings.timer),e.submitting=!0,g.validate.call(i),!1},resetForm:function(){var e=l(this),a=e.data("yiiActiveForm");window.setTimeout(function(){l.each(a.attributes,function(){this.value=x(e,this),this.status=0;var t=e.find(this.container),i=T(e,this);("input"===a.settings.validationStateOn?i:t).removeClass(a.settings.validatingCssClass+" "+a.settings.errorCssClass+" "+a.settings.successCssClass),t.find(this.error).html("")}),e.find(a.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(t,i){var e=l(this),a=e.data("yiiActiveForm");l.each(a.attributes,function(){w(e,this,t)}),i&&O(e,t)},updateAttribute:function(t,i){var e=g.find.call(this,t);if(null!=e){var a={};a[t]=i,w(l(this),e,a)}}},y=function(i,e){var t=T(i,e);e.validateOnChange&&t.on("change.yiiActiveForm",function(){a(i,e,!1)}),e.validateOnBlur&&t.on("blur.yiiActiveForm",function(){0!=e.status&&1!=e.status||a(i,e,!0)}),e.validateOnType&&t.on("keyup.yiiActiveForm",function(t){-1===l.inArray(t.which,[16,17,18,37,38,39,40])&&e.value!==x(i,e)&&a(i,e,!1,e.validationDelay)})},b=function(t,i){T(t,i).off(".yiiActiveForm")},a=function(t,i,e,a){var n=t.data("yiiActiveForm");e&&(i.status=2),l.each(n.attributes,function(){this.value!==x(t,this)&&(this.status=2,e=!0)}),e&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=window.setTimeout(function(){n.submitting||t.is(":hidden")||(l.each(n.attributes,function(){2===this.status&&(this.status=3,t.find(this.container).addClass(n.settings.validatingCssClass))}),g.validate.call(t))},a||200))},p=function(){var t=[];return t.add=function(t){this.push(new l.Deferred(t))},t},A=["action","target","method","enctype"],C=function(t){for(var i={},e=0;e<A.length;e++)i[A[e]]=t.attr(A[e]);return i},F=function(t,i,e){var a=t.data("yiiActiveForm");if(void 0===a)return!1;if(e){var n=[],r=T(t,this);if(l.each(a.attributes,function(){r.is(":disabled")||this.cancelled||!w(t,this,i)||n.push(this)}),t.trigger(u,[i,n]),O(t,i),n.length){if(a.settings.scrollToError){var s=t.find(l.map(n,function(t){return t.input}).join(",")).first().closest(":visible").offset().top-a.settings.scrollToErrorOffset;s<0?s=0:s>l(document).height()&&(s=l(document).height());var o=l(window).scrollTop();(s<o||s>o+l(window).height())&&l(window).scrollTop(s)}a.submitting=!1}else a.validated=!0,a.submitObject&&function(t,i){for(var e=0;e<A.length;e++){var a=i.attr("form"+A[e]);a&&t.attr(A[e],a)}}(t,a.submitObject),t.submit(),a.submitObject&&function(t){for(var i=t.data("yiiActiveForm"),e=0;e<A.length;e++)t.attr(A[e],i.options[A[e]]||null)}(t)}else l.each(a.attributes,function(){this.cancelled||2!==this.status&&3!==this.status||w(t,this,i)});m(t)},j=function(t){var i=t.data("yiiActiveForm").submitObject||t.find(":submit:first");if(i.length&&"submit"==i.attr("type")&&i.attr("name")){var e=l('input[type="hidden"][name="'+i.attr("name")+'"]',t);e.length?e.attr("value",i.attr("value")):l("<input>").attr({type:"hidden",name:i.attr("name"),value:i.attr("value")}).appendTo(t)}},w=function(t,i,e){var a=t.data("yiiActiveForm"),n=T(t,i),r=!1;if(l.isArray(e[i.id])||(e[i.id]=[]),i.status=1,n.length){r=0<e[i.id].length;var s=t.find(i.container),o=s.find(i.error);S(t,i,r);var u="input"===a.settings.validationStateOn?n:s;r?(i.encodeError?o.text(e[i.id][0]):o.html(e[i.id][0]),u.removeClass(a.settings.validatingCssClass+" "+a.settings.successCssClass).addClass(a.settings.errorCssClass)):(o.empty(),u.removeClass(a.settings.validatingCssClass+" "+a.settings.errorCssClass+" ").addClass(a.settings.successCssClass)),i.value=x(t,i)}return t.trigger(c,[i,e[i.id]]),r},O=function(t,i){var e=t.data("yiiActiveForm"),a=t.find(e.settings.errorSummary),n=a.find("ul").empty();a.length&&i&&(l.each(e.attributes,function(){if(l.isArray(i[this.id])&&i[this.id].length){var t=l("<li/>");e.settings.encodeErrorSummary?t.text(i[this.id][0]):t.html(i[this.id][0]),n.append(t)}}),a.toggle(0<n.find("li").length))},x=function(t,i){var e=T(t,i),a=e.attr("type");if("checkbox"!==a&&"radio"!==a)return e.val();var n=e.filter(":checked");return n.length||(n=t.find('input[type=hidden][name="'+e.attr("name")+'"]')),n.val()},T=function(t,i){var e=t.find(i.input);return e.length&&"div"===e[0].tagName.toLowerCase()?e.find("input"):e},S=function(t,i,e){i.updateAriaInvalid&&t.find(i.input).attr("aria-invalid",e?"true":"false")}}(window.jQuery);