!function(n){var s={threshold:200,imageIdentifierPrefix:"lazy-image-",imageSelector:".lazy-image:not(.lazy-placeholder, .loaded)",placeholderClass:"lazy-placeholder",defaultAspectRatio:1.777777778,loaderHtml:'<div class="loader"></div>'},t={viewportChanged:!1,touchScrolling:!1,resized:!1},l=[],c=0,i=function(){l=[],n(s.imageSelector).each(function(e){if(!n(this).hasClass("loaded")){var i=c+=1;n(this).addClass(s.imageIdentifierPrefix+i);var t=parseInt(n(this).attr("data-width")),a=parseInt(n(this).attr("data-height")),r=s.defaultAspectRatio,o=n(this).attr("data-as-background");t&&a&&(r=a/t);var d=!1;1<=n(this).next("."+s.placeholderClass).length&&(d=!0),l.push({id:i,source:n(this).attr("data-src"),boundaries:{},hasPlaceholderImage:n(this).hasClass("lazyimage"),divPlaceholderExists:d,width:t,height:a,aspectRatio:r,asBackground:o,html:n(this)[0].outerHTML})}}),e(),r()},e=function(){n(l).each(function(e){if(!this.hasPlaceholderImage&&!this.asBackground&&!this.divPlaceholderExists){var i=n("."+s.imageIdentifierPrefix+this.id),t=i.attr("class");"string"==typeof t&&(t=t.replace(s.imageIdentifierPrefix+this.id,""));var a=n("<div/>",{class:s.placeholderClass+" "+t});a.append(n("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),a.append(n(s.loaderHtml)),a.insertAfter(i),l[e]&&(l[e].divPlaceholderExists=!0)}})},a=function(){var e,i=(e=function(){return n.grep(l,function(e){if(void 0===e)return!1;n(window).scrollTop(),n(window).innerHeight();return s.threshold,s.threshold,!0})},t.resized?(t.resized=!1,r(e())):e());n(i).each(function(){var e=n("<img/>",{src:this.source}),t=this,a=l.map(function(e){return e.id}).indexOf(t.id);e.on("load",function(){delete l[a];var e=n("."+s.imageIdentifierPrefix+t.id),i=e.next("."+s.placeholderClass);e.attr("src",t.source),e.addClass("loaded"),t.asBackground?n("."+s.imageIdentifierPrefix+t.id).css({backgroundImage:"url("+t.source+")"}):t.hasPlaceholderImage||i.hide(),n(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+s.imageIdentifierPrefix+t.id})}),e.on("error",function(){delete l[a],n(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+s.imageIdentifierPrefix+t.id})})})},r=function(e){for(var i in l){var t=l[i],a=n("."+s.imageIdentifierPrefix+t.id),r=a.next("."+s.placeholderClass),o=0<r.length?r.offset().top:a.offset().top;t.boundaries={top:o,bottom:o+(0<r.length?r.outerHeight():a.outerHeight())},l[i]=t}if("function"==typeof e)return e()};n.lazyLoad=function(e){if("string"==typeof e)switch(e){case"refetchElements":i(),a()}else e&&(s=n.extend(s,e)),i(),setInterval(function(){!0!==t.viewportChanged&&!0!==t.touchScrolling||(a(),t.viewportChanged=!1,t.touchScrolling=!1)},250),n(document).on("touchmove",function(){t.touchScrolling=!0}),n(window).on("scroll resize",function(){t.viewportChanged=!0,t.touchScrolling=!1}),n(window).on("resize",function(){t.resized=!0}),a();return this}}(jQuery);